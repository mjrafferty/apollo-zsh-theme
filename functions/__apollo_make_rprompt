# vim:ft=zsh

__apollo_make_rprompt(){

  local prompt_length current_module line_index
  local -a left_modules right_modules

  zstyle -a 'apollo:core:modules:left' modules left_modules
  zstyle -a 'apollo:core:modules:right' modules right_modules

  line_index="$1"

  prompt_length="${#right_modules[@]}"

  __APOLLO_RETURN_MESSAGE=""

  while ((__APOLLO_CURRENT_RPROMPT <= prompt_length)); do

    current_module="${right_modules[__APOLLO_CURRENT_RPROMPT]}"

    case "${current_module}" in
      "newline")
        ((__APOLLO_CURRENT_RPROMPT++));
        break;
        ;;
      *)
        __APOLLO_RETURN_MESSAGE+="\${__APOLLO_RIGHT_SEPARATORS[$__APOLLO_CURRENT_RPROMPT]}\${__APOLLO_MODULE_TEXT[$current_module]}"
        __APOLLO_RIGHT_HAS_LENGTH[line_index]+=" + \$__APOLLO_MODULE_HAS_LENGTH[$current_module]"
        ((__APOLLO_CURRENT_RPROMPT++));
        ;;
    esac

  done

}

__apollo_make_rprompt "$@"
