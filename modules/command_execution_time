# vim:ft=bash
################################################################
# Display the duration the command needed to run.

typeset -gi APOLLO_COMMAND_EXECUTION_TIME_PRECISION=2
typeset -g  APOLLO_COMMAND_EXECUTION_TIME_FG="white"
typeset -g  APOLLO_COMMAND_EXECUTION_TIME_BG="navy"

typeset -gF _APOLLO_COMMAND_DURATION
typeset -gF _APOLLO_TIMER_START

_apollo_command_execution_time_run() {

  _APOLLO_COMMAND_DURATION=$((EPOCHREALTIME - _APOLLO_TIMER_START))
  _APOLLO_TIMER_START=1e10

  local humanReadableDuration

  if (( _APOLLO_COMMAND_DURATION < APOLLO_COMMAND_EXECUTION_TIME_THRESHOLD )); then
    _APOLLO_RETURN_MESSAGE=""
    return
  fi

  if (( _APOLLO_COMMAND_DURATION < 60 )); then

    if ((APOLLO_COMMAND_EXECUTION_TIME_PRECISION == 0)); then
      typeset -i humanReadableDuration
    else
      typeset -F ${APOLLO_COMMAND_EXECUTION_TIME_PRECISION} humanReadableDuration
    fi

    humanReadableDuration=$_APOLLO_COMMAND_DURATION

  elif (( _APOLLO_COMMAND_DURATION < 3600 )); then

    humanReadableDuration=$(TZ=GMT; strftime '%M:%S' $(( int(rint(_APOLLO_COMMAND_DURATION)) )))

  else

    humanReadableDuration=$(TZ=GMT; strftime '%H:%M:%S' $(( int(rint(_APOLLO_COMMAND_DURATION)) )))

  fi

  _APOLLO_RETURN_MESSAGE="${humanReadableDuration}"

}

_apollo_command_execution_time_module_setup(){

  _APOLLO_TIMER_START=1e10

}

_apollo_command_execution_time_module_preexec(){
  _APOLLO_TIMER_START=$EPOCHREALTIME
}
